<?php //description: Renders the list of public jobs. ?>
<?php
$this->headScript()->appendFile($this->basepath('/Core/js/core.pagination-container.js'))
     ->appendFile($this->basePath('Core/js/core.forms.js'))
     ->appendFile($this->basePath('assets/select2/js/select2.min.js'));
if ($this->params('lang') != 'en') {
    $this->headScript()->appendFile($this->basePath('assets/select2/js/i18n/' . $this->params('lang') . '.js'));
}
$this->headLink()->appendStylesheet($this->basePath('assets/select2/css/select2.css'))
?>
<?php

$queryGet = $this->params()->fromQuery();
unset($queryGet['clear']);
$query= !count($queryGet) ? $this->params()->fromRoute('q', 304) : 0;
$wordpress = $this->proxy('wordpress');

$this->headMeta()->setName('description', $wordpress->chain(['page' => $query, 'value' => 'meta-fields.description'], ''));
$this->headMeta()->setName('keywords', $wordpress->call('value', ['meta-fields.keywords'], ''));
$description = $wordpress->call('value', ['content.rendered'], '');

$title = $wordpress->call('value', ['meta-fields.title'], '');
$this->headTitle($title ?: $this->translate('Jobs'));

$robots = "noindex,follow";
if ($description) { $robots = substr($robots, 2); }
$this->headMeta()->setName('robots', $robots);
$this->headScript()->captureStart();
?>
(function($) {

    $(function() {
        var $tabbar = $('#search-tabs');

        $('#jobs-list-container').on('yk-paginator-container:loaded.gastro24 g24-jobs:init', function(ev) {
            $tabbar.show();
            var html = $('#jobs-list-container').find('.pagination-content').html();

            if ('' === html.trim()) { $tabbar.hide(); }
        }).trigger('g24-jobs:init');

        var $jobCount = $('#job-count');

        $('#jobs-list-container').on('yk-paginator-container:loaded.gastro24-job-count', function(ev) {
            var count = $('#update-job-count').text();
            $jobCount.text(count);
        });

        $('#jobs-list-filter').on('reset.gastro24', function(ev) { $(ev.target).find('input.facet-param').remove(); });

    });
})(jQuery);
<?php $this->headScript()->captureEnd();?>

<?php if ($jobs instanceof \Solr\FacetsProviderInterface): $this->headScript()->appendFile($this->basePath('Gastro24/jobs.facets.js')); endif; ?>



<?php echo $this->flashMessenger()->render('default', array('alert', 'alert-success')) ?>

<nav class="navbar yk-toolbar" id="jobs-list-filter-wrapper">
    <div class="search-form-container">
        <?php
            $queryParams = $this->params()->fromQuery();
            foreach (array_keys($this->jobs->getFacets()->toArray()) as $facetName):
                if (isset($queryParams[$facetName])):
                    foreach (array_keys($queryParams[$facetName]) as $facetValue):
                        $this->filterForm->add(['type' => 'hidden', 'name' => $facetName . '[' . $facetValue . ']',
                                                'attributes' => ['class' => 'facet-param', 'value' => 1]]);
                    endforeach;
                endif;
            endforeach;$this->filterForm->setButtonElement('q');
            //$this->filterForm->add( ['type' => 'hidden', 'name' => 'clear', 'attributes' => ['value' => 1]]);
            $this->filterForm->setAttribute('data-handle-by', 'native');
            $this->filterForm->setAttribute('action', $this->url('lang/jobboard', [], true));
             echo $this->searchForm($this->filterForm)  ?>
    </div>
</nav>
  <div class="container">
     <div class="row">
	     <div class="header-tab-bar" style="padding:25px 0">
		 
             <h1 class="text-center"> <?=$wordpress->call('value', ['title.rendered'], '') ?: 'Jobs gefunden'; ?></h1>
             <?php $parts=preg_split('~<!--more-->~' , $description);?>
			 <p class="similar-jobs text-center"><?=$parts[0]?></p>
		 </div>
	 </div>
 </div>
<nav class="profession-tab-bar" style="background-color: #ccc;margin-bottom:20px">
    <div class="container">
        <div class="row">
            <ul id="search-tabs" class="nav nav-tabs" style="padding:0 30px">
                <li class="active">
                    <a data-toggle="tab" href="#jobs-list-container"><!-- <span id="job-count"><?=$this->jobs->getTotalItemCount()?></span> --> Offene Stellen</a>
                </li>
                <?php if (isset($parts[1]) && ""!=trim($parts[1])): ?><li><a data-toggle="tab" href="#wp-content1">TÃ¤tigkeit</a></li><?php endif ?>
                <?php if (isset($parts[2]) && ""!=trim($parts[2])): ?><li><a data-toggle="tab" href="#wp-content2">Lohn</a></li><?php endif ?>
                <?php if (isset($parts[3]) && ""!=trim($parts[3])): ?><li><a data-toggle="tab" href="#wp-content3">Karriere & Weiterbildung</a></li><?php endif ?>
                <?php if (isset($parts[4]) && ""!=trim($parts[4])): ?><li><a data-toggle="tab" href="#wp-content4">Erfahrungsberichte</a></li><?php endif ?>
            </ul>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="tab-content">
            <div id="jobs-list-container" class="pagination-container tab-pane fade in active"
                 data-message="<?php echo $this->escapeHtmlAttr(sprintf(
                                                                    $this->translate('%sSorry%s, there are not any jobs matching your search criteria.'
                                                                    ),
                                                                    '<strong>', '</strong>'
                                                                )
                 ) ?>"
                 data-uri="<?php
                 echo $this->url('lang/jobboard', array(), array('query' => $this->params()->fromQuery()), true) ?>">

                <!--   <h3>Insgesamt <span id="job-count"><?= $this->jobs->getTotalItemCount(
                ) ?></span> freie Stellen zur Auswahl</h3>-->


                <div class="pagination-content">
                    <?php echo $this->render('jobs/jobboard/index.ajax.phtml') ?>
                </div>
            </div>
            <?php if (isset($parts[1]) && "" != trim($parts[1])): ?>
                <div id="wp-content1" class="tab-pane fade">
                    <?= $parts[1] ?>
                    <?php if (51 == $query): echo $this->landingpages(); endif; ?>
                </div>
            <?php endif ?>
            <?php if (isset($parts[2]) && "" != trim($parts[2])): ?>
                <div id="wp-content2" class="tab-pane fade">
                    <?= $parts[2] ?>
                    <?php if (51 == $query): echo $this->landingpages(); endif; ?>
                </div>
            <?php endif ?>
            <?php if (isset($parts[3]) && "" != trim($parts[3])): ?>
                <div id="wp-content3" class="tab-pane fade">
                    <?= $parts[3] ?>
                    <?php if (51 == $query): echo $this->landingpages(); endif; ?>
                </div>
            <?php endif ?>
            <?php if (isset($parts[4]) && "" != trim($parts[4])): ?>
                <div id="wp-content4" class="tab-pane fade">
                    <?= $parts[4] ?>
                    <?php if (51 == $query): echo $this->landingpages(); endif; ?>
                </div>
            <?php endif ?>
        </div>
    </div>
</div>